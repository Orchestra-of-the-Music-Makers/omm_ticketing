<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script src="/pdf.js"></script>
    <script src="/pdf_viewer.js"></script>
    <script src="/booklet.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/pdf_viewer.css" />
  </head>
  <body>
    <pre id="elm"></pre>
    <script type="text/javascript">
      if('serviceWorker' in navigator) {
        navigator.serviceWorker
                .register('/sw.js')
                .then(function() { console.log("Service Worker Registered"); });
      }

      window.addEventListener('online', () => console.log('Became online'));
      window.addEventListener('offline', () => console.log('Became offline'));

      var urlParams = new URLSearchParams(window.location.search);

      var flags = {displaySurveyBanner: urlParams.get('displayBanner') == '1'};
      var app = Elm.Booklet.init({
        node: document.getElementById("elm"),
        flags: flags,
      });

      // CONCERT DATA, change here for different pdfs
      var url = "assets/Mahler_Mobile.pdf";
      var pdfjsLib = window['pdfjs-dist/build/pdf'];
      var pdfjsViewer = window['pdfjs-dist/web/pdf_viewer'];

      // The workerSrc property shall be specified.
      pdfjsLib.GlobalWorkerOptions.workerSrc = '/pdf.worker.js';

      const container = document.getElementById('pdf-viewer');
      const eventBus = new pdfjsViewer.EventBus();

      // enable hyperlinks within PDF files.
      const pdfLinkService = new pdfjsViewer.PDFLinkService({
          eventBus,
      });

      const pdfViewer = new pdfjsViewer.PDFViewer({
          container,
          eventBus,
          linkService: pdfLinkService,
      });
      pdfLinkService.setViewer(pdfViewer);

      eventBus.on("pagesinit", function () {
          pdfViewer.currentScaleValue = "page-width";
        });
      pdfjsLib.getDocument(url).promise.then(pdf => {
          pdfViewer.setDocument(pdf);
          pdfLinkService.setDocument(pdf, null);
      });
    </script>
  </body>
</html>
